name: Lint code on push and test locally 

on:
  push:
    branches:
      - main
      - feature-*
  pull_request:
    branches:
      - main
      - feature-*

jobs:
  linter:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Run ansible lint
        uses: ansible/ansible-lint@main
        with:
          args: -c .ansible-lint

  test-locally:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Run ansible playbook
        shell: bash
        run: ansible-playbook playbook.yml -i dynamic.vmware.yml
